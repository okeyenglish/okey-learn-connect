
# ĞŸĞ»Ğ°Ğ½: ĞĞµĞ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ¾Ğ² Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€Ğ°

## ĞĞ±Ğ·Ğ¾Ñ€

Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ´Ğ»Ñ WhatsApp (Green API, Wappi, WPP), Telegram (Wappi) Ğ¸ MAX (Green API) Ñ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ¹ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒÑ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞµ.

## Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     messenger_settings              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ organization_id + messenger_type    â”‚
â”‚ â†’ Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ 1 Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ñ‚Ğ¸Ğ¿        â”‚
â”‚ â†’ Ğ’ÑĞµ credentials Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ JSONB     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     messenger_integrations (ĞĞĞ’ĞĞ¯ Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: UUID (PK)                                                   â”‚
â”‚ organization_id: UUID                                           â”‚
â”‚ messenger_type: 'whatsapp' | 'telegram' | 'max'                 â”‚
â”‚ provider: 'green_api' | 'wappi' | 'wpp'                         â”‚
â”‚ name: "WhatsApp ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹", "WhatsApp ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸"                   â”‚
â”‚ is_primary: boolean (Ğ¾Ğ´Ğ¸Ğ½ primary Ğ½Ğ° org+type)                  â”‚
â”‚ is_enabled: boolean                                             â”‚
â”‚ webhook_key: unique random string (Ğ´Ğ»Ñ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ²ĞµĞ±Ñ…ÑƒĞºĞ°)   â”‚
â”‚ settings: JSONB (instanceId, apiToken, etc.)                    â”‚
â”‚ priority: integer (Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº fallback)                            â”‚
â”‚ phone_label: "+7 999 123-45-67" (Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ°)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     chat_messages (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ğ°Ñ)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ integration_id: UUID (NEW) â†’ ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ° Ğº ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹

```text
ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ Ğ¡ĞĞĞ‘Ğ©Ğ•ĞĞ˜Ğ¯:

1. ĞÑ‚Ğ²ĞµÑ‚ Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´ÑÑ‰ĞµĞµ?
   â”œâ”€â”€ Ğ”Ğ â†’ ĞĞ°Ğ¹Ñ‚Ğ¸ integration_id Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾ Ğ¾Ñ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
   â”‚        â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Ñ‚Ñƒ Ğ¶Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
   â”‚
   â””â”€â”€ ĞĞ•Ğ¢ (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³) â†’ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ primary Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

2. ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
   â”œâ”€â”€ Ğ£ÑĞ¿ĞµÑ… â†’ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ integration_id
   â”‚
   â””â”€â”€ ĞÑˆĞ¸Ğ±ĞºĞ° â†’ ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ Ğ¿Ğ¾ priority
               â†’ ĞŸĞµÑ€ĞµĞ±Ñ€Ğ°Ñ‚ÑŒ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ
               â†’ Ğ’ÑĞµ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ½Ğ¾ â†’ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ 'failed'
```

## Ğ¤Ğ°Ğ·Ğ° 1: Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 1.1 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `messenger_integrations`

```sql
CREATE TABLE messenger_integrations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
  messenger_type TEXT NOT NULL CHECK (messenger_type IN ('whatsapp', 'telegram', 'max')),
  provider TEXT NOT NULL, -- 'green_api', 'wappi', 'wpp'
  name TEXT NOT NULL,
  is_primary BOOLEAN DEFAULT false,
  is_enabled BOOLEAN DEFAULT true,
  webhook_key TEXT UNIQUE NOT NULL,
  settings JSONB NOT NULL DEFAULT '{}',
  priority INTEGER DEFAULT 100,
  phone_label TEXT, -- Ğ”Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ "+7 999 123-45-67"
  last_error TEXT,
  last_error_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ primary Ğ½Ğ° organization + messenger_type
CREATE UNIQUE INDEX idx_primary_integration 
  ON messenger_integrations(organization_id, messenger_type) 
  WHERE is_primary = true;

-- Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ğ¾ webhook_key
CREATE INDEX idx_integration_webhook_key ON messenger_integrations(webhook_key);

-- RLS Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
ALTER TABLE messenger_integrations ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own org integrations"
  ON messenger_integrations FOR SELECT
  USING (organization_id = get_user_organization_id());

CREATE POLICY "Admins can manage integrations"
  ON messenger_integrations FOR ALL
  USING (is_admin() AND organization_id = get_user_organization_id());

CREATE POLICY "Service role full access"
  ON messenger_integrations FOR ALL
  USING (true);
```

### 1.2 Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `chat_messages`

```sql
ALTER TABLE chat_messages 
ADD COLUMN integration_id UUID REFERENCES messenger_integrations(id);

CREATE INDEX idx_messages_integration 
  ON chat_messages(client_id, messenger, direction, created_at DESC)
  WHERE integration_id IS NOT NULL;
```

### 1.3 ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```sql
-- ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº WhatsApp
INSERT INTO messenger_integrations (
  organization_id, messenger_type, provider, name, 
  is_primary, webhook_key, settings, is_enabled
)
SELECT 
  organization_id,
  'whatsapp',
  CASE 
    WHEN settings->>'provider' = 'wappi' THEN 'wappi'
    WHEN settings->>'provider' = 'wpp' THEN 'wpp'
    ELSE 'green_api'
  END,
  'WhatsApp (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹)',
  true,
  encode(gen_random_bytes(12), 'hex'),
  settings,
  is_enabled
FROM messenger_settings
WHERE messenger_type = 'whatsapp';

-- ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ telegram Ğ¸ max
```

## Ğ¤Ğ°Ğ·Ğ° 2: Edge Functions â€” Ğ’ĞµĞ±Ñ…ÑƒĞºĞ¸

### 2.1 ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ URL Ğ²ĞµĞ±Ñ…ÑƒĞºĞ¾Ğ²

```text
Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹: /functions/v1/whatsapp-webhook
ĞĞ¾Ğ²Ñ‹Ğ¹:  /functions/v1/whatsapp-webhook?key=UNIQUE_WEBHOOK_KEY
```

### 2.2 ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ĞµĞ±Ñ…ÑƒĞº-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
- `supabase/functions/whatsapp-webhook/index.ts`
- `supabase/functions/wappi-whatsapp-webhook/index.ts`
- `supabase/functions/wpp-webhook/index.ts`
- `supabase/functions/telegram-webhook/index.ts`
- `supabase/functions/max-webhook/index.ts`

**ĞĞ¾Ğ²Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°:**

```typescript
// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ webhook_key Ğ¸Ğ· URL
const url = new URL(req.url);
const webhookKey = url.searchParams.get('key');

// ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
const { data: integration } = await supabase
  .from('messenger_integrations')
  .select('id, organization_id, settings, is_enabled')
  .eq('webhook_key', webhookKey)
  .single();

// Fallback Ğ½Ğ° ÑÑ‚Ğ°Ñ€ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ (Ğ¿Ğ¾ instanceId) Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
if (!integration) {
  // Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ğ¾ instanceId
}

// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ integration_id
await supabase.from('chat_messages').insert({
  ...messageData,
  integration_id: integration.id
});
```

## Ğ¤Ğ°Ğ·Ğ° 3: Edge Functions â€” ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ Fallback

### 3.1 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ shared-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»: `supabase/functions/_shared/integration-resolver.ts`**

```typescript
export async function getIntegrationsForSend(
  supabase: SupabaseClient,
  organizationId: string,
  clientId: string,
  messengerType: 'whatsapp' | 'telegram' | 'max',
  specificIntegrationId?: string
): Promise<string[]> {
  const integrationIds: string[] = [];
  
  // 1. Ğ•ÑĞ»Ğ¸ ÑƒĞºĞ°Ğ·Ğ°Ğ½ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ integration_id
  if (specificIntegrationId) {
    integrationIds.push(specificIntegrationId);
  }
  
  // 2. ĞĞ°Ğ¹Ñ‚Ğ¸ integration_id Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
  const { data: lastIncoming } = await supabase
    .from('chat_messages')
    .select('integration_id')
    .eq('client_id', clientId)
    .eq('messenger', messengerType)
    .eq('direction', 'incoming')
    .not('integration_id', 'is', null)
    .order('created_at', { ascending: false })
    .limit(1)
    .maybeSingle();
  
  if (lastIncoming?.integration_id && !integrationIds.includes(lastIncoming.integration_id)) {
    integrationIds.push(lastIncoming.integration_id);
  }
  
  // 3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ primary Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
  const { data: primary } = await supabase
    .from('messenger_integrations')
    .select('id')
    .eq('organization_id', organizationId)
    .eq('messenger_type', messengerType)
    .eq('is_primary', true)
    .eq('is_enabled', true)
    .maybeSingle();
  
  if (primary?.id && !integrationIds.includes(primary.id)) {
    integrationIds.push(primary.id);
  }
  
  // 4. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ (Ğ¿Ğ¾ priority)
  const { data: others } = await supabase
    .from('messenger_integrations')
    .select('id')
    .eq('organization_id', organizationId)
    .eq('messenger_type', messengerType)
    .eq('is_enabled', true)
    .order('priority', { ascending: true });
  
  for (const integration of others || []) {
    if (!integrationIds.includes(integration.id)) {
      integrationIds.push(integration.id);
    }
  }
  
  return integrationIds;
}

export async function sendWithFallback(
  supabase: SupabaseClient,
  integrationIds: string[],
  sendFn: (settings: any) => Promise<{ success: boolean; messageId?: string; error?: string }>
): Promise<{ success: boolean; integrationId?: string; messageId?: string; error?: string }> {
  
  for (const integrationId of integrationIds) {
    const { data: integration } = await supabase
      .from('messenger_integrations')
      .select('id, settings, provider')
      .eq('id', integrationId)
      .eq('is_enabled', true)
      .single();
    
    if (!integration) continue;
    
    try {
      const result = await sendFn(integration);
      
      if (result.success) {
        // ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ°
        await supabase
          .from('messenger_integrations')
          .update({ last_error: null, last_error_at: null })
          .eq('id', integrationId);
        
        return { 
          success: true, 
          integrationId, 
          messageId: result.messageId 
        };
      }
      
      // Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ
      await supabase
        .from('messenger_integrations')
        .update({ 
          last_error: result.error, 
          last_error_at: new Date().toISOString() 
        })
        .eq('id', integrationId);
      
    } catch (error) {
      console.error(`Integration ${integrationId} failed:`, error);
    }
  }
  
  return { success: false, error: 'All integrations failed' };
}
```

### 3.2 ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ send-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
- `supabase/functions/whatsapp-send/index.ts`
- `supabase/functions/wappi-whatsapp-send/index.ts`
- `supabase/functions/wpp-send/index.ts`
- `supabase/functions/telegram-send/index.ts`
- `supabase/functions/max-send/index.ts`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ğ¾Ğ¹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸:**

```typescript
// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
const integrationIds = await getIntegrationsForSend(
  supabase, organizationId, clientId, 'whatsapp'
);

// ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ fallback
const result = await sendWithFallback(supabase, integrationIds, async (integration) => {
  const settings = integration.settings;
  // ... Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€
});

// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ integration_id
if (result.success) {
  await supabase.from('chat_messages').insert({
    ...messageData,
    integration_id: result.integrationId
  });
}
```

## Ğ¤Ğ°Ğ·Ğ° 4: Frontend â€” ChatArea

### 4.1 ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ `src/components/crm/ChatArea.tsx`

**Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
1. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ `integration_id` Ğ¸Ğ· Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
2. ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° `integration_id` Ğ² API Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
3. ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ğ± Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

```typescript
// ĞŸÑ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
const getIntegrationId = async (messengerType: string): Promise<string | null> => {
  const { data } = await supabase
    .from('chat_messages')
    .select('integration_id')
    .eq('client_id', clientId)
    .eq('messenger', messengerType)
    .eq('direction', 'incoming')
    .not('integration_id', 'is', null)
    .order('created_at', { ascending: false })
    .limit(1)
    .maybeSingle();
  
  return data?.integration_id || null;
};
```

## Ğ¤Ğ°Ğ·Ğ° 5: ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ â€” UI ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸

### 5.1 ĞĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ `IntegrationsList.tsx`

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WhatsApp                                               [+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â˜°  ğŸ“± WhatsApp ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹           âœ“ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½     â˜… Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹    â”‚ â”‚
â”‚  â”‚     Green API â€¢ +7 (999) 123-45-67                              â”‚ â”‚
â”‚  â”‚     Webhook: .../whatsapp-webhook?key=abc123...   [ğŸ“‹]          â”‚ â”‚
â”‚  â”‚     [ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ] [Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ]                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â˜°  ğŸ“± WhatsApp ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸            âœ“ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½                   â”‚ â”‚
â”‚  â”‚     Wappi.pro â€¢ +7 (999) 987-65-43                              â”‚ â”‚
â”‚  â”‚     Webhook: .../wappi-whatsapp-webhook?key=def456...   [ğŸ“‹]    â”‚ â”‚
â”‚  â”‚     [ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ] [Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¼] [Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ]                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â˜°  ğŸ“± WhatsApp Self-hosted        âš  ĞÑˆĞ¸Ğ±ĞºĞ°                      â”‚ â”‚
â”‚  â”‚     WPP Connect â€¢ +7 (999) 555-55-55                            â”‚ â”‚
â”‚  â”‚     ĞÑˆĞ¸Ğ±ĞºĞ°: Instance not authorized (5 Ğ¼Ğ¸Ğ½ Ğ½Ğ°Ğ·Ğ°Ğ´)               â”‚ â”‚
â”‚  â”‚     [ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ] [Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ]                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  â˜° â€” Drag-and-drop Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ° fallback                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ĞĞ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| `src/components/admin/integrations/IntegrationsList.tsx` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ¼ĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€Ğ° |
| `src/components/admin/integrations/IntegrationCard.tsx` | ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ |
| `src/components/admin/integrations/AddIntegrationDialog.tsx` | ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ |
| `src/components/admin/integrations/EditIntegrationDialog.tsx` | ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ |
| `src/components/admin/integrations/ProviderSelector.tsx` | Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° (Green API / Wappi / WPP) |
| `src/hooks/useMessengerIntegrations.ts` | Hook Ğ´Ğ»Ñ CRUD Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ |

### 5.3 ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ `MessengersSettings.tsx`

Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº (WhatsAppSettings, TelegramWappiSettings, MaxGreenApiSettings) Ğ½Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑƒĞ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ UI Ñ `IntegrationsList`.

### 5.4 Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» UI

1. **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸:**
   - Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ‚Ğ¸Ğ¿Ğ° Ğ¼ĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€Ğ°
   - Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
   - Ğ’Ğ²Ğ¾Ğ´ credentials
   - ĞĞ²Ñ‚Ğ¾Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ webhook_key
   - ĞŸĞ¾ĞºĞ°Ğ· webhook URL Ğ´Ğ»Ñ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

2. **Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
   - Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ¼ĞµĞ½Ğ¸
   - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ credentials
   - Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ/Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

3. **Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ¾Ğ¼:**
   - Drag-and-drop Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ°
   - Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ (is_primary)

4. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³:**
   - Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ (online/offline/error)
   - ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ
   - Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ

## Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ

| ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ | Ğ¤Ğ°Ğ¹Ğ»Ñ‹ |
|-----------|-------|
| **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** | ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ SQL |
| **Shared** | `supabase/functions/_shared/integration-resolver.ts` (Ğ½Ğ¾Ğ²Ñ‹Ğ¹) |
| **Ğ’ĞµĞ±Ñ…ÑƒĞºĞ¸** | `whatsapp-webhook`, `wappi-whatsapp-webhook`, `wpp-webhook`, `telegram-webhook`, `max-webhook` |
| **ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°** | `whatsapp-send`, `wappi-whatsapp-send`, `wpp-send`, `telegram-send`, `max-send` |
| **Frontend** | `ChatArea.tsx`, `MessengersSettings.tsx` |
| **ĞĞ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹** | `IntegrationsList.tsx`, `IntegrationCard.tsx`, `AddIntegrationDialog.tsx`, `EditIntegrationDialog.tsx` |
| **Hooks** | `useMessengerIntegrations.ts` (Ğ½Ğ¾Ğ²Ñ‹Ğ¹), `useMessengerIntegrationStatus.ts` (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ) |

## ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

1. **Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ Ğ²ĞµĞ±Ñ…ÑƒĞºĞ¸ Ğ±ĞµĞ· ?key=** â€” fallback Ğ½Ğ° Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ instanceId (ĞºĞ°Ğº ÑĞµĞ¹Ñ‡Ğ°Ñ)
2. **Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ±ĞµĞ· integration_id** â€” Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ primary Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
3. **ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ** â€” ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑÑÑ‚ÑÑ ĞºĞ°Ğº primary

## ĞÑ†ĞµĞ½ĞºĞ° Ñ‚Ñ€ÑƒĞ´Ğ¾Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚

| Ğ¤Ğ°Ğ·Ğ° | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ’Ñ€ĞµĞ¼Ñ |
|------|----------|-------|
| 1 | Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… + Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ | 2-3 Ñ‡Ğ°ÑĞ° |
| 2 | ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ 5 Ğ²ĞµĞ±Ñ…ÑƒĞºĞ¾Ğ² | 3-4 Ñ‡Ğ°ÑĞ° |
| 3 | ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ 5 send-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ | 4-5 Ñ‡Ğ°ÑĞ¾Ğ² |
| 4 | ChatArea + Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | 2-3 Ñ‡Ğ°ÑĞ° |
| 5 | ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ UI | 6-8 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ˜Ñ‚Ğ¾Ğ³Ğ¾** | | **17-23 Ñ‡Ğ°ÑĞ°** |
