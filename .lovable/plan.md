
## Исправление: Сообщения преподавателей не отображаются

### Проблема
RPC функция `get_teacher_unread_counts` на self-hosted сервере возвращает пустые данные, из-за чего в списке преподавателей отображается "Нет сообщений".

### Что сделано в коде

**Файл:** `src/hooks/useTeacherChats.ts`

Добавлен fallback механизм: если RPC функция не работает или возвращает пустые данные, код делает прямые запросы к таблицам для поиска связей преподаватель↔клиент по телефону.

### Что нужно сделать на self-hosted сервере

Для оптимальной производительности выполнить SQL скрипт:

```bash
docker compose exec db psql -U postgres -d postgres -f /path/to/docs/fix-teacher-unread-counts.sql
```

Или скопировать содержимое файла `docs/fix-teacher-unread-counts.sql` в SQL editor Supabase Studio.

### Поведение после исправления

1. Если RPC функция существует и работает — используется она (быстро)
2. Если RPC недоступна — автоматический fallback на прямые запросы
3. Связь преподаватель↔клиент определяется по совпадению телефонов

### WPP интеграция

Для диагностики WPP проблем проверить:
1. Статус сессии в настройках интеграций
2. Логи Edge Function `wpp-webhook`
3. Соединение с msg.academyos.ru
