
## План: Синхронизация данных мессенджеров для преподавателей ✅ ЗАВЕРШЕНО

### Обзор
Добавлена синхронизация данных мессенджеров (MAX, WhatsApp) в соответствующие вебхуки. При общении с клиентом, связанным с преподавателем, данные автоматически обновляются в таблице `teachers`.

### Выполненные задачи

#### ✅ 1. Обновлен max-webhook/index.ts
Добавлена функция `syncTeacherFromClient` для синхронизации:
- `phone` - если у преподавателя нет телефона
- `max_user_id` - извлекается из chatId
- `max_chat_id` - полный идентификатор чата

#### ✅ 2. Обновлен whatsapp-webhook/index.ts (Green API)
Добавлена функция для синхронизации:
- `phone`
- `whatsapp_id` - извлекается из chatId

#### ✅ 3. Обновлен wappi-whatsapp-webhook/index.ts (Wappi)
Добавлена синхронизация:
- `phone`
- `whatsapp_id`

### Логика синхронизации
1. При получении входящего сообщения
2. Проверяется наличие связи client_id -> teacher_id в teacher_client_links
3. Если связь есть - обновляются данные преподавателя
4. Обновляются только пустые поля (не перезаписываются существующие)

### Результат
Когда преподаватель пишет в любой мессенджер (Telegram, WhatsApp, MAX), его контактные данные автоматически синхронизируются с карточкой преподавателя.

**ВАЖНО**: Необходимо задеплоить обновлённые Edge Functions на self-hosted сервер (api.academyos.ru) согласно инструкции в `docs/migration/11-deploy-edge-functions-to-selfhosted.md`.
