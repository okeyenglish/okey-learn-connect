

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–≤–æ–Ω–∫–∞ —á–µ—Ä–µ–∑ OnlinePBX

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å
–°–¥–µ–ª–∞—Ç—å –∏–∫–æ–Ω–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Ä—è–¥–æ–º —Å –Ω–æ–º–µ—Ä–æ–º –∫–ª–∏–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–π - –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –Ω–µ—ë –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ OnlinePBX API.

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ò–∫–æ–Ω–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (Phone) —É–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä—è–¥–æ–º —Å –Ω–æ–º–µ—Ä–æ–º –≤ `ContactInfoBlock`, –Ω–æ –æ–Ω–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ - —Å–ª—É–∂–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
- Edge Function `onlinepbx-call` —É–∂–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `OnlinePBXPhone` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `PhoneNumberManager`

### –ü–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π

**1. –û–±–Ω–æ–≤–∏—Ç—å `src/components/crm/ContactInfoBlock.tsx`**

- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π callback `onCallClick?: (phone: string) => void` –≤ props –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –°–¥–µ–ª–∞—Ç—å –∏–∫–æ–Ω–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π —Å hover-—ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
- –ü—Ä–∏ –∫–ª–∏–∫–µ –≤—ã–∑—ã–≤–∞—Ç—å `onCallClick` —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- –î–æ–±–∞–≤–∏—Ç—å Tooltip —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π "–ü–æ–∑–≤–æ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ OnlinePBX"
- –°—Ç–∏–ª–∏–∑–æ–≤–∞—Ç—å –∏–∫–æ–Ω–∫—É –∫–∞–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é (cursor-pointer, hover-—ç—Ñ—Ñ–µ–∫—Ç)

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìû +7 (916) 123-45-67  üìã  ‚≠ê               ‚îÇ
‚îÇ  ‚Üë                                           ‚îÇ
‚îÇ  –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è –∏–∫–æ–Ω–∫–∞                         ‚îÇ
‚îÇ  –ü—Ä–∏ –∫–ª–∏–∫–µ ‚Üí –∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ OnlinePBX          ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  –°–ø—Ä–∞–≤–∞: –∏–∫–æ–Ω–∫–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ (WA, TG, MAX)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**2. –û–±–Ω–æ–≤–∏—Ç—å `src/components/crm/FamilyCard.tsx`**

- –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `handlePhoneCall` –¥–ª—è –≤—ã–∑–æ–≤–∞ OnlinePBX —á–µ—Ä–µ–∑ `selfHostedPost`
- –ü–µ—Ä–µ–¥–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ `ContactInfoBlock` —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π prop `onCallClick`
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–≤–æ–Ω–∫–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

–õ–æ–≥–∏–∫–∞ –∑–≤–æ–Ω–∫–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ ChatArea.tsx):
```typescript
const handlePhoneCall = async (phone: string) => {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    toast.error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
    return;
  }
  
  const response = await selfHostedPost('onlinepbx-call', { 
    to_number: phone,
    from_user: user.id
  });
  
  if (response.data?.success) {
    toast.success('–ó–≤–æ–Ω–æ–∫ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω. –ü–æ–¥–Ω–∏–º–∏—Ç–µ —Ç—Ä—É–±–∫—É.');
  } else {
    toast.error(response.data?.error || '–û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞');
  }
};
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Ä—è–¥–æ–º —Å –ª—é–±—ã–º –Ω–æ–º–µ—Ä–æ–º –∫–ª–∏–µ–Ω—Ç–∞
- –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–≤–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ OnlinePBX
- –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–ª—É—á–∏—Ç –≤—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –Ω–∞ —Å–≤–æ—é —Ç—Ä—É–±–∫—É, –ø–æ—Å–ª–µ –ø–æ–¥–Ω—è—Ç–∏—è –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –¥–æ–∑–≤–æ–Ω –∫–ª–∏–µ–Ω—Ç—É
- –ó–≤–æ–Ω–æ–∫ –±—É–¥–µ—Ç –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é –∑–≤–æ–Ω–∫–æ–≤

