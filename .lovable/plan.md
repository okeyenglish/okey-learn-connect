
# Массовая перепривязка клиентов к филиалам через CSV

## Что будет сделано

Новая страница/модальное окно в админ-панели, где можно:
1. Загрузить CSV-файл с номерами телефонов клиентов
2. Выбрать филиал из реального списка (те же филиалы, что используются для распределения менеджеров)
3. Нажать кнопку и массово обновить поле `branch` у всех найденных клиентов

## Как это работает

1. Пользователь загружает CSV (формат: один столбец с телефонами, или автоопределение колонки с телефонами)
2. Система парсит файл через `papaparse`, нормализует номера через `normalizePhone`
3. Пользователь выбирает целевой филиал из списка `branches` (из `src/lib/branches.ts`)
4. По нажатию "Применить" система находит клиентов по телефону на self-hosted и обновляет `branch` через `PATCH` к PostgREST API
5. Показывается прогресс и итоги: сколько обновлено, сколько не найдено

## Технические детали

### Новый компонент: `src/components/admin/BulkBranchReassign.tsx`
- Загрузка CSV через `<input type="file">`
- Парсинг через `Papa.parse` (аналогично `BulkTeacherImport`)
- Автоопределение колонки с телефонами
- Селектор филиала из `branches` (из `src/lib/branches.ts`)
- Пакетное обновление: поиск клиентов по номеру через `GET /rest/v1/clients?phone=eq.{phone}`, затем `PATCH /rest/v1/clients?id=eq.{id}` с `{ branch: selectedBranch }`
- Батчинг по 10 запросов для стабильности
- Прогресс-бар, счетчики успехов/ошибок/не найденных

### Интеграция
- Компонент добавляется на страницу настроек или в админ-раздел (рядом с `BulkTeacherImport`)
- Используется `SELF_HOSTED_URL` + `SELF_HOSTED_ANON_KEY` (паттерн из `useUpdateClient`)
- После обновления инвалидируются кэши `clients` и `chat-threads`

### Список филиалов для выбора
Берется из `src/lib/branches.ts` -- те же филиалы, что используются в `useManagerBranches` для распределения:
- Котельники
- Новокосино
- Окская
- Стахановская
- Солнцево
- Мытищи
- Люберцы
- Красная горка
- Онлайн школа
