/**
 * Smart Replies â€” contextual clichÃ© suggestions based on last incoming message.
 * Pure client-side logic, no DB calls.
 *
 * NOTE: We avoid \b word boundaries because they don't work reliably with
 * Cyrillic characters in JavaScript regex. Instead we use case-insensitive
 * `.includes()` for trigger matching.
 */

export type SmartReplyCategory =
  | 'gratitude'
  | 'greeting'
  | 'farewell'
  | 'agreement'
  | 'apology'
  | 'waiting_status'
  | 'help_request'
  | 'sent_info'
  | 'client_waiting'
  | 'lesson_meeting'
  | 'booking_confirm'
  | 'negative'
  | 'price_question'
  | 'thinking'
  | 'returning';

interface SmartReplyRule {
  category: SmartReplyCategory;
  triggers: string[];
  replies: string[];
}

const rules: SmartReplyRule[] = [
  {
    category: 'gratitude',
    triggers: ['ÑÐ¿Ð°ÑÐ¸Ð±Ð¾', 'Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ', 'ÑÐ¿Ñ', 'thanks', 'thank you', 'Ð¾Ð³Ñ€Ð¾Ð¼Ð½Ð¾Ðµ ÑÐ¿Ð°ÑÐ¸Ð±Ð¾'],
    replies: [
      'Ð’ÑÐµÐ³Ð´Ð° Ñ€Ð°Ð´Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ!',
      'ÐžÐ±Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚ÐµÑÑŒ, ÐµÑÐ»Ð¸ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹!',
      'Ð Ð°Ð´Ñ‹ Ð±Ñ‹Ð»Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ!',
      'Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ!',
      'Ð¥Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð²Ð°Ð¼ Ð´Ð½Ñ!',
    ],
  },
  {
    category: 'greeting',
    triggers: ['Ð·Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ', 'Ð´Ð¾Ð±Ñ€Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ', 'Ð´Ð¾Ð±Ñ€Ñ‹Ð¹ Ð²ÐµÑ‡ÐµÑ€', 'Ð´Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾', 'Ð¿Ñ€Ð¸Ð²ÐµÑ‚', 'hello', 'hi'],
    replies: [
      'Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ! Ð§ÐµÐ¼ Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?',
      'Ð”Ð¾Ð±Ñ€Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ! Ð¡Ð»ÑƒÑˆÐ°ÑŽ Ð²Ð°Ñ ðŸ™‚',
      'Ð Ð°Ð´Ñ‹ Ð²Ð°Ñ ÑÐ»Ñ‹ÑˆÐ°Ñ‚ÑŒ! Ð§ÐµÐ¼ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?',
      'Ð—Ð´Ñ€Ð°Ð²ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ! ÐŸÐ¾Ð´ÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ, Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð°Ñˆ Ð²Ð¾Ð¿Ñ€Ð¾Ñ',
    ],
  },
  {
    category: 'farewell',
    triggers: ['Ð´Ð¾ ÑÐ²Ð¸Ð´Ð°Ð½Ð¸Ñ', 'Ð¿Ð¾ÐºÐ°', 'Ð²ÑÐµÐ³Ð¾ Ð´Ð¾Ð±Ñ€Ð¾Ð³Ð¾', 'Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð´Ð½Ñ', 'Ð´Ð¾ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð¸', 'bye', 'goodbye'],
    replies: [
      'Ð”Ð¾ ÑÐ²Ð¸Ð´Ð°Ð½Ð¸Ñ! Ð¥Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð´Ð½Ñ!',
      'Ð’ÑÐµÐ³Ð¾ Ð´Ð¾Ð±Ñ€Ð¾Ð³Ð¾! ÐžÐ±Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚ÐµÑÑŒ!',
      'Ð‘ÑƒÐ´ÐµÐ¼ Ñ€Ð°Ð´Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ ÑÐ½Ð¾Ð²Ð°!',
      'Ð¥Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð´Ð½Ñ Ð¸ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ!',
    ],
  },
  {
    category: 'agreement',
    triggers: ['Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾', 'Ð¾Ðº', 'okay', 'Ð¿Ð¾Ð½ÑÐ»', 'Ð¿Ð¾Ð½ÑÐ»Ð°', 'Ð»Ð°Ð´Ð½Ð¾', 'Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð»Ð¸ÑÑŒ', 'ÑÐ¾Ð³Ð»Ð°ÑÐµÐ½', 'ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð°'],
    replies: [
      'ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾, Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð»Ð¸ÑÑŒ!',
      'Ð¢Ð¾Ð³Ð´Ð° Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ ðŸ™‚',
      'ÐŸÑ€Ð¸Ð½ÑÑ‚Ð¾!',
      'Ð•ÑÐ»Ð¸ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ â€” Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ!',
    ],
  },
  {
    category: 'apology',
    triggers: ['Ð¸Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ', 'Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ñ‚Ðµ', 'ÑÐ¾Ñ€Ñ€Ð¸', 'Ð¿Ñ€Ð¾ÑˆÑƒ Ð¿Ñ€Ð¾Ñ‰ÐµÐ½Ð¸Ñ', 'sorry'],
    replies: [
      'ÐÐ¸Ñ‡ÐµÐ³Ð¾ ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾Ð³Ð¾!',
      'Ð’ÑÑ‘ Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ ðŸ™‚',
      'ÐÐµ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°Ð¹Ñ‚Ðµ!',
      'Ð’ÑÑ‘ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾, Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼',
    ],
  },
  {
    category: 'waiting_status',
    triggers: ['Ð½Ñƒ Ñ‡Ñ‚Ð¾', 'ÐµÑÑ‚ÑŒ Ð½Ð¾Ð²Ð¾ÑÑ‚Ð¸', 'ÐºÐ¾Ð³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚', 'Ð¶Ð´Ñƒ', 'Ð¾Ñ‚Ð²ÐµÑ‚ Ð±ÑƒÐ´ÐµÑ‚', 'Ð²Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ð»Ð¸', 'Ñ‡Ñ‚Ð¾ Ñ‚Ð°Ð¼'],
    replies: [
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŽ Ð¸ Ð²ÐµÑ€Ð½ÑƒÑÑŒ Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð¼',
      'Ð£Ð¶Ðµ ÑƒÑ‚Ð¾Ñ‡Ð½ÑÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ',
      'Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ðµ!',
      'ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÐºÐ¾Ñ€Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐµÐ¼',
    ],
  },
  {
    category: 'help_request',
    triggers: ['Ð¿Ð¾Ð¼Ð¾Ð³Ð¸Ñ‚Ðµ', 'Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚', 'Ð¾ÑˆÐ¸Ð±ÐºÐ°', 'Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ', 'Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°'],
    replies: [
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÐ¼ Ñ€Ð°Ð·Ð¾Ð±Ñ€Ð°Ñ‚ÑŒÑÑ',
      'ÐžÐ¿Ð¸ÑˆÐ¸Ñ‚Ðµ, Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÑŽ',
      'ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð¼ Ð¸ Ð²ÑÑ‘ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ð¼',
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÑŽ, Ð² Ñ‡Ñ‘Ð¼ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð´ÐµÐ»Ð¾',
    ],
  },
  {
    category: 'sent_info',
    triggers: ['Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð»', 'ÑÐºÐ¸Ð½ÑƒÐ»', 'ÑÐºÐ¸Ð½ÑƒÐ»Ð°', 'Ð²Ð¾Ñ‚', 'Ð´ÐµÑ€Ð¶Ð¸Ñ‚Ðµ', 'Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ð»', 'Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ð»Ð°'],
    replies: [
      'Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»!',
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÑŽ',
      'ÐŸÑ€Ð¸Ð½ÑÑ‚Ð¾, Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑŽ',
      'Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ, Ð¸Ð·ÑƒÑ‡Ð°ÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ',
    ],
  },
  {
    category: 'client_waiting',
    triggers: ['ÑÐµÐº', 'ÑÐµÐºÑƒÐ½Ð´Ñƒ', 'Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ', 'ÑÐµÐ¹Ñ‡Ð°Ñ', 'Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ', 'Ð¼Ð¸Ð½ÑƒÑ‚ÐºÑƒ'],
    replies: [
      'Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾, Ð¾Ð¶Ð¸Ð´Ð°ÑŽ ðŸ™‚',
      'Ð‘ÐµÐ· Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼, Ð¶Ð´Ñƒ',
      'ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ, ÐºÐ°Ðº Ð±ÑƒÐ´ÐµÑ‚Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹',
    ],
  },
  {
    category: 'lesson_meeting',
    triggers: ['Ð·Ð°Ð½ÑÑ‚Ð¸Ðµ', 'ÑƒÑ€Ð¾Ðº', 'Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°', 'ÑÐ¾Ð·Ð²Ð¾Ð½', 'ÐºÐ¾Ð³Ð´Ð° ÑƒÑ€Ð¾Ðº', 'Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ', 'Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ'],
    replies: [
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŽ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ',
      'ÐŸÐ¾Ð´Ð±ÐµÑ€Ñ‘Ð¼ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ',
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ ÑƒÑ‚Ð¾Ñ‡Ð½ÑŽ Ñƒ Ð¿Ñ€ÐµÐ¿Ð¾Ð´Ð°Ð²Ð°Ñ‚ÐµÐ»Ñ',
      'Ð—Ð°Ð¿Ð¸ÑˆÑƒ Ð²Ð°Ñ Ð½Ð° Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐµ Ð¾ÐºÐ½Ð¾',
    ],
  },
  {
    category: 'booking_confirm',
    triggers: ['Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚', 'Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°Ð¹Ñ‚Ðµ', 'Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ', 'Ð¾Ðº Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚', 'Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´Ð°ÑŽ'],
    replies: [
      'ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾, Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÑŽ Ð²Ð°Ñ!',
      'Ð“Ð¾Ñ‚Ð¾Ð²Ð¾ âœ…',
      'Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð°',
      'Ð’ÑÑ‘ Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ð» ðŸ™‚',
    ],
  },
  {
    category: 'negative',
    triggers: ['Ð¿Ð»Ð¾Ñ…Ð¾', 'Ð½Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ', 'ÑƒÐ¶Ð°Ñ', 'Ð½ÐµÐ´Ð¾Ð²Ð¾Ð»ÐµÐ½', 'Ð½ÐµÐ´Ð¾Ð²Ð¾Ð»ÑŒÐ½Ð°', 'Ð¶Ð°Ð»Ð¾Ð±Ð°', 'Ð²Ð¾Ð·Ð¼ÑƒÑ‰'],
    replies: [
      'ÐŸÐ¾Ð½Ð¸Ð¼Ð°ÑŽ Ð²Ð°Ñ, Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ñ€Ð°Ð·Ð±ÐµÑ€Ñ‘Ð¼ÑÑ',
      'Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ñ‡Ñ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ð»Ð¸',
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð²ÑÑ‘ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ð¼',
      'ÐŸÐ¾Ð¼Ð¾Ð¶ÐµÐ¼ Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÑŽ',
    ],
  },
  {
    category: 'price_question',
    triggers: ['ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾Ð¸Ñ‚', 'ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾ÑÑ‚', 'Ñ†ÐµÐ½Ð°', 'ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ', 'Ñ‚Ð°Ñ€Ð¸Ñ„', 'Ð¿Ñ€Ð°Ð¹Ñ'],
    replies: [
      'Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ñ€Ð°ÑÑÐºÐ°Ð¶Ñƒ Ð¿Ð¾ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ ðŸ™‚',
      'ÐŸÐ¾Ð´Ð±ÐµÑ€Ñ‘Ð¼ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚',
      'ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑŽ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹',
    ],
  },
  {
    category: 'thinking',
    triggers: ['Ð¿Ð¾Ð´ÑƒÐ¼Ð°ÑŽ', 'Ð¿Ð¾ÐºÐ° Ð½Ðµ Ð·Ð½Ð°ÑŽ', 'Ð½Ð°Ð´Ð¾ Ð¿Ð¾Ð´ÑƒÐ¼Ð°Ñ‚ÑŒ', 'Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½', 'Ð½Ðµ ÑƒÐ²ÐµÑ€ÐµÐ½Ð°'],
    replies: [
      'ÐšÐ¾Ð½ÐµÑ‡Ð½Ð¾, Ð½Ðµ ÑÐ¿ÐµÑˆÐ¸Ñ‚Ðµ ðŸ™‚',
      'Ð•ÑÐ»Ð¸ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ â€” Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ!',
      'Ð‘ÑƒÐ´Ñƒ Ð½Ð° ÑÐ²ÑÐ·Ð¸',
    ],
  },
  {
    category: 'returning',
    triggers: ['ÑÐ½Ð¾Ð²Ð°', 'ÐµÑ‰Ñ‘ Ð²Ð¾Ð¿Ñ€Ð¾Ñ', 'Ð¾Ð¿ÑÑ‚ÑŒ Ñ', 'ÐµÑ‰Ñ‘ Ñ€Ð°Ð·'],
    replies: [
      'Ð Ð°Ð´Ñ‹ ÑÐ½Ð¾Ð²Ð° Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ!',
      'Ð¡Ð»ÑƒÑˆÐ°ÑŽ Ð²Ð°Ñ ðŸ™‚',
      'Ð§ÐµÐ¼ Ð¼Ð¾Ð¶ÐµÐ¼ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ð² ÑÑ‚Ð¾Ñ‚ Ñ€Ð°Ð·?',
    ],
  },
];

function matchesTrigger(text: string, triggers: string[]): boolean {
  const normalized = text.trim().toLowerCase();
  return triggers.some((t) => normalized.includes(t));
}

export function detectCategory(text: string): SmartReplyCategory | null {
  if (!text) return null;
  for (const rule of rules) {
    if (matchesTrigger(text, rule.triggers)) {
      return rule.category;
    }
  }
  return null;
}

export function getSmartReplies(text: string): string[] {
  if (!text) return [];
  for (const rule of rules) {
    if (matchesTrigger(text, rule.triggers)) {
      return rule.replies;
    }
  }
  return [];
}
