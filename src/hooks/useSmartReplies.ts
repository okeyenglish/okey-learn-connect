/**
 * Smart Replies ‚Äî contextual clich√© suggestions based on last incoming message.
 * Pure client-side logic, no DB calls.
 */

export type SmartReplyCategory =
  | 'gratitude'
  | 'greeting'
  | 'farewell'
  | 'agreement'
  | 'apology'
  | 'waiting_status'
  | 'help_request'
  | 'sent_info'
  | 'client_waiting'
  | 'lesson_meeting'
  | 'booking_confirm'
  | 'negative'
  | 'price_question'
  | 'thinking'
  | 'returning';

interface SmartReplyRule {
  category: SmartReplyCategory;
  triggers: RegExp;
  replies: string[];
}

const rules: SmartReplyRule[] = [
  {
    category: 'gratitude',
    triggers: /\b(—Å–ø–∞—Å–∏–±–æ|–±–ª–∞–≥–æ–¥–∞—Ä—é|—Å–ø—Å|thanks|thank you|–æ–≥—Ä–æ–º–Ω–æ–µ —Å–ø–∞—Å–∏–±–æ)\b/i,
    replies: [
      '–í—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –ø–æ–º–æ—á—å!',
      '–û–±—Ä–∞—â–∞–π—Ç–µ—Å—å, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã!',
      '–†–∞–¥—ã –±—ã–ª–∏ –ø–æ–º–æ—á—å!',
      '–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ!',
      '–•–æ—Ä–æ—à–µ–≥–æ –≤–∞–º –¥–Ω—è!',
    ],
  },
  {
    category: 'greeting',
    triggers: /\b(–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ|–¥–æ–±—Ä—ã–π –¥–µ–Ω—å|–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä|–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ|–ø—Ä–∏–≤–µ—Ç|hello|hi)\b/i,
    replies: [
      '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
      '–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –°–ª—É—à–∞—é –≤–∞—Å üôÇ',
      '–†–∞–¥—ã –≤–∞—Å —Å–ª—ã—à–∞—Ç—å! –ß–µ–º –ø–æ–º–æ—á—å?',
      '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–∞—à –≤–æ–ø—Ä–æ—Å',
    ],
  },
  {
    category: 'farewell',
    triggers: /\b(–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è|–ø–æ–∫–∞|–≤—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ|—Ö–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è|–¥–æ –≤—Å—Ç—Ä–µ—á–∏|bye|goodbye)\b/i,
    replies: [
      '–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è!',
      '–í—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ! –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å!',
      '–ë—É–¥–µ–º —Ä–∞–¥—ã –ø–æ–º–æ—á—å —Å–Ω–æ–≤–∞!',
      '–•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è –∏ –æ—Ç–ª–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è!',
    ],
  },
  {
    category: 'agreement',
    triggers: /\b(—Ö–æ—Ä–æ—à–æ|–æ–∫|okay|–ø–æ–Ω—è–ª|–ø–æ–Ω—è–ª–∞|–ª–∞–¥–Ω–æ|–¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å|—Å–æ–≥–ª–∞—Å–µ–Ω|—Å–æ–≥–ª–∞—Å–Ω–∞)\b/i,
    replies: [
      '–û—Ç–ª–∏—á–Ω–æ, –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å!',
      '–¢–æ–≥–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º üôÇ',
      '–ü—Ä–∏–Ω—è—Ç–æ!',
      '–ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø–∏—à–∏—Ç–µ!',
    ],
  },
  {
    category: 'apology',
    triggers: /\b(–∏–∑–≤–∏–Ω–∏—Ç–µ|–ø—Ä–æ—Å—Ç–∏—Ç–µ|—Å–æ—Ä—Ä–∏|–ø—Ä–æ—à—É –ø—Ä–æ—â–µ–Ω–∏—è|sorry)\b/i,
    replies: [
      '–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ!',
      '–í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ üôÇ',
      '–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ!',
      '–í—Å—ë —Ö–æ—Ä–æ—à–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º',
    ],
  },
  {
    category: 'waiting_status',
    triggers: /\b(–Ω—É —á—Ç–æ|–µ—Å—Ç—å –Ω–æ–≤–æ—Å—Ç–∏|–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç|–∂–¥—É|–æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç|–≤—ã –ø—Ä–æ–≤–µ—Ä–∏–ª–∏|—á—Ç–æ —Ç–∞–º)\b/i,
    replies: [
      '–°–µ–π—á–∞—Å –ø—Ä–æ–≤–µ—Ä—é –∏ –≤–µ—Ä–Ω—É—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º',
      '–£–∂–µ —É—Ç–æ—á–Ω—è—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é',
      '–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–∂–∏–¥–∞–Ω–∏–µ!',
      '–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ—Ä–æ –Ω–∞–ø–∏—à–µ–º',
    ],
  },
  {
    category: 'help_request',
    triggers: /\b(–ø–æ–º–æ–≥–∏—Ç–µ|–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç|–æ—à–∏–±–∫–∞|–Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è|–ø—Ä–æ–±–ª–µ–º–∞)\b/i,
    replies: [
      '–°–µ–π—á–∞—Å –ø–æ–º–æ–∂–µ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è',
      '–û–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Å–∏—Ç—É–∞—Ü–∏—é',
      '–ü—Ä–æ–≤–µ—Ä–∏–º –∏ –≤—Å—ë –∏—Å–ø—Ä–∞–≤–∏–º',
      '–°–µ–π—á–∞—Å –ø–æ—Å–º–æ—Ç—Ä—é, –≤ —á—ë–º –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–ª–æ',
    ],
  },
  {
    category: 'sent_info',
    triggers: /\b(–æ—Ç–ø—Ä–∞–≤–∏–ª|—Å–∫–∏–Ω—É–ª|—Å–∫–∏–Ω—É–ª–∞|–≤–æ—Ç|–¥–µ—Ä–∂–∏—Ç–µ|–ø—Ä–∏–∫—Ä–µ–ø–∏–ª|–ø—Ä–∏–∫—Ä–µ–ø–∏–ª–∞)\b/i,
    replies: [
      '–°–ø–∞—Å–∏–±–æ, –ø–æ–ª—É—á–∏–ª!',
      '–°–µ–π—á–∞—Å –ø–æ—Å–º–æ—Ç—Ä—é',
      '–ü—Ä–∏–Ω—è—Ç–æ, –ø—Ä–æ–≤–µ—Ä—è—é',
      '–ë–ª–∞–≥–æ–¥–∞—Ä—é, –∏–∑—É—á–∞—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é',
    ],
  },
  {
    category: 'client_waiting',
    triggers: /\b(—Å–µ–∫|—Å–µ–∫—É–Ω–¥—É|–º–∏–Ω—É—Ç—É|—Å–µ–π—á–∞—Å|–ø–æ–¥–æ–∂–¥–∏—Ç–µ|–º–∏–Ω—É—Ç–∫—É)\b/i,
    replies: [
      '–•–æ—Ä–æ—à–æ, –æ–∂–∏–¥–∞—é üôÇ',
      '–ë–µ–∑ –ø—Ä–æ–±–ª–µ–º, –∂–¥—É',
      '–ù–∞–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã',
    ],
  },
  {
    category: 'lesson_meeting',
    triggers: /\b(–∑–∞–Ω—è—Ç–∏–µ|—É—Ä–æ–∫|–≤—Å—Ç—Ä–µ—á–∞|—Å–æ–∑–≤–æ–Ω|–∫–æ–≥–¥–∞ —É—Ä–æ–∫|—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ|–∑–∞–ø–∏—Å–∞—Ç—å—Å—è)\b/i,
    replies: [
      '–°–µ–π—á–∞—Å –ø—Ä–æ–≤–µ—Ä—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ',
      '–ü–æ–¥–±–µ—Ä—ë–º —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è',
      '–°–µ–π—á–∞—Å —É—Ç–æ—á–Ω—é —É –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è',
      '–ó–∞–ø–∏—à—É –≤–∞—Å –Ω–∞ –±–ª–∏–∂–∞–π—à–µ–µ –æ–∫–Ω–æ',
    ],
  },
  {
    category: 'booking_confirm',
    triggers: /\b(–ø–æ–¥—Ö–æ–¥–∏—Ç|–∑–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ|–¥–∞–≤–∞–π—Ç–µ|–æ–∫ –ø–æ–¥—Ö–æ–¥–∏—Ç|–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é)\b/i,
    replies: [
      '–û—Ç–ª–∏—á–Ω–æ, –∑–∞–ø–∏—Å—ã–≤–∞—é –≤–∞—Å!',
      '–ì–æ—Ç–æ–≤–æ ‚úÖ',
      '–ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞',
      '–í—Å—ë –æ—Ñ–æ—Ä–º–∏–ª üôÇ',
    ],
  },
  {
    category: 'negative',
    triggers: /\b(–ø–ª–æ—Ö–æ|–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è|—É–∂–∞—Å|–Ω–µ–¥–æ–≤–æ–ª–µ–Ω|–Ω–µ–¥–æ–≤–æ–ª—å–Ω–∞|–∂–∞–ª–æ–±–∞|–≤–æ–∑–º—É—â)\b/i,
    replies: [
      '–ü–æ–Ω–∏–º–∞—é –≤–∞—Å, –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º—Å—è',
      '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Å–æ–æ–±—â–∏–ª–∏',
      '–°–µ–π—á–∞—Å –≤—Å—ë –ø—Ä–æ–≤–µ—Ä–∏–º',
      '–ü–æ–º–æ–∂–µ–º —Ä–µ—à–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é',
    ],
  },
  {
    category: 'price_question',
    triggers: /\b(—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç|—Ü–µ–Ω–∞|—Å—Ç–æ–∏–º–æ—Å—Ç—å|—Ç–∞—Ä–∏—Ñ|–ø—Ä–∞–π—Å)\b/i,
    replies: [
      '–°–µ–π—á–∞—Å —Ä–∞—Å—Å–∫–∞–∂—É –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ üôÇ',
      '–ü–æ–¥–±–µ—Ä—ë–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç',
      '–û—Ç–ø—Ä–∞–≤–ª—è—é –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã',
    ],
  },
  {
    category: 'thinking',
    triggers: /\b(–ø–æ–¥—É–º–∞—é|–ø–æ–∫–∞ –Ω–µ –∑–Ω–∞—é|–Ω–∞–¥–æ –ø–æ–¥—É–º–∞—Ç—å|–Ω–µ —É–≤–µ—Ä–µ–Ω|–Ω–µ —É–≤–µ—Ä–µ–Ω–∞)\b/i,
    replies: [
      '–ö–æ–Ω–µ—á–Ω–æ, –Ω–µ —Å–ø–µ—à–∏—Ç–µ üôÇ',
      '–ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø–∏—à–∏—Ç–µ!',
      '–ë—É–¥—É –Ω–∞ —Å–≤—è–∑–∏',
    ],
  },
  {
    category: 'returning',
    triggers: /\b(—Å–Ω–æ–≤–∞|–µ—â—ë –≤–æ–ø—Ä–æ—Å|–æ–ø—è—Ç—å —è|–µ—â—ë —Ä–∞–∑)\b/i,
    replies: [
      '–†–∞–¥—ã —Å–Ω–æ–≤–∞ –ø–æ–º–æ—á—å!',
      '–°–ª—É—à–∞—é –≤–∞—Å üôÇ',
      '–ß–µ–º –º–æ–∂–µ–º –ø–æ–º–æ—á—å –≤ —ç—Ç–æ—Ç —Ä–∞–∑?',
    ],
  },
];

export function detectCategory(text: string): SmartReplyCategory | null {
  if (!text) return null;
  const normalized = text.trim().toLowerCase();
  for (const rule of rules) {
    if (rule.triggers.test(normalized)) {
      return rule.category;
    }
  }
  return null;
}

export function getSmartReplies(text: string): string[] {
  if (!text) return [];
  const normalized = text.trim().toLowerCase();
  for (const rule of rules) {
    if (rule.triggers.test(normalized)) {
      return rule.replies;
    }
  }
  return [];
}
